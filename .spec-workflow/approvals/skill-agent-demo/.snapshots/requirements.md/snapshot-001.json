{
  "id": "snapshot_1763020752184_buwy9m7gl",
  "approvalId": "approval_1763020752171_qscgulmx2",
  "approvalTitle": "Skill Agent Demo - Requirements Document",
  "version": 1,
  "timestamp": "2025-11-13T07:59:12.184Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document - Skill Agent Demo\n\n## Introduction\n\n这是一个 StudyX Skill Agent 系统的可演示 MVP（最小可行产品），用于展示从\"工具箱模式\"到\"智能学习助手模式\"的架构升级。该 demo 将实现核心的意图识别、记忆管理、技能编排和技能执行功能，通过一个统一的聊天界面为用户提供无缝的学习体验。\n\n**核心价值：**\n- 用户无需在多个工具间跳转，一个对话框完成所有学习任务\n- 系统自动理解用户意图并选择合适的技能\n- 记住学习进度和用户偏好，提供个性化体验\n- 降低 token 成本（按需加载 Skill Prompt，而非大杂烩）\n\n**Demo 场景：** 微积分学习助手，支持练习题生成和概念讲解两个核心技能。\n\n## Alignment with Product Vision\n\n根据 `General.md` PRD 文档，本 demo 实现了以下核心目标：\n\n1. **用户体验提升**：从支离破碎的多工具跳转，升级为连续流畅的对话式学习\n2. **高效意图分析**：轻量级 Intent Router 准确识别用户需求\n3. **成本控制**：按需加载 Skill Prompt，避免大量无关上下文消耗 token\n4. **可扩展架构**：通过 Skill Registry 实现技能的插件化管理\n\n## Requirements\n\n### Requirement 1: 统一聊天界面\n\n**User Story:** 作为学生，我希望在一个对话界面中完成所有学习任务（解题、讲解、练习），而不是在多个工具间跳转，从而获得连续流畅的学习体验。\n\n#### Acceptance Criteria\n\n1. WHEN 用户打开应用 THEN 系统 SHALL 显示一个统一的聊天界面\n2. WHEN 用户输入学习请求（如\"给我几道极限练习题\"）THEN 系统 SHALL 在同一界面中返回结构化结果\n3. WHEN 用户在同一会话中提出不同类型的请求（练习 → 讲解）THEN 系统 SHALL 在同一对话流中响应，无需页面跳转\n4. WHEN 系统返回不同类型的内容（练习题、文字讲解）THEN 界面 SHALL 根据内容类型自动选择合适的渲染组件\n\n### Requirement 2: 智能意图识别\n\n**User Story:** 作为学生，我希望系统能理解我的自然语言请求（如\"帮我练习极限\"），并自动判断我需要什么类型的帮助，而不需要我手动选择工具。\n\n#### Acceptance Criteria\n\n1. WHEN 用户输入自然语言请求 THEN Intent Router SHALL 解析出结构化意图（intent, topic, confidence）\n2. WHEN 意图识别置信度 >= 0.6 THEN 系统 SHALL 接受该意图并继续执行\n3. WHEN 意图识别置信度 < 0.6 THEN 系统 SHALL 返回澄清性问题（如\"你是想要练习题还是概念讲解？\"）\n4. WHEN 用户输入包含明确关键词（如\"练习题\"、\"讲解\"）THEN 系统 SHALL 正确识别对应的意图标签（quiz、explain）\n5. WHEN 识别失败 THEN 系统 SHALL fallback 到 explain 意图（默认讲解模式）\n\n### Requirement 3: 学习记忆管理\n\n**User Story:** 作为学生，我希望系统能记住我的学习进度和偏好（如我在哪些知识点薄弱、更喜欢练习题还是讲解），从而提供个性化的学习建议。\n\n#### Acceptance Criteria\n\n1. WHEN 用户首次使用 THEN Memory Manager SHALL 创建空的 UserLearningProfile 和 SessionContext\n2. WHEN 用户完成一次练习 THEN 系统 SHALL 更新 mastery_map（知识点掌握度）\n3. WHEN 用户多次使用某种学习方式（如连续做题）THEN 系统 SHALL 记录用户偏好（preferred_artifact）\n4. WHEN Intent Router 需要上下文 THEN Memory Manager SHALL 提供简短的记忆摘要（≤ 100 tokens）\n5. WHEN 会话结束 THEN SessionContext SHALL 被清理，UserLearningProfile SHALL 被持久化\n\n### Requirement 4: 技能注册与发现\n\n**User Story:** 作为系统开发者，我希望通过标准化的 Skill Registry 管理所有技能定义，从而快速添加新技能而不影响核心系统。\n\n#### Acceptance Criteria\n\n1. WHEN 系统启动 THEN Skill Registry SHALL 加载所有技能定义文件（JSON/YAML）\n2. WHEN Orchestrator 需要查找技能 THEN Registry SHALL 根据 intent_tags 返回匹配的技能列表\n3. WHEN 查询技能定义 THEN Registry SHALL 返回完整的 input_schema、output_schema、models 配置\n4. WHEN 验证技能输入参数 THEN Registry SHALL 使用 JSON Schema 验证参数有效性\n5. WHEN 添加新技能 THEN 只需创建新的 skill.json 文件，无需修改核心代码\n\n### Requirement 5: 技能智能编排\n\n**User Story:** 作为学生，我希望系统能自动选择最合适的技能来响应我的请求，并智能地构建执行参数（如根据我的掌握度选择练习题难度）。\n\n#### Acceptance Criteria\n\n1. WHEN Intent Router 返回意图结果 THEN Skill Orchestrator SHALL 从 Registry 查找匹配的技能\n2. WHEN 多个技能匹配同一意图 THEN Orchestrator SHALL 根据成本、用户偏好选择最优技能\n3. WHEN 构建技能输入参数 THEN Orchestrator SHALL 结合 intent、memory、user_profile 生成完整的 params + context\n4. WHEN 技能执行完成 THEN Orchestrator SHALL 封装结果为统一的 artifact 格式\n5. WHEN 技能执行失败 THEN Orchestrator SHALL 尝试 fallback 模型或 fallback 技能\n6. WHEN 结果返回前 THEN Orchestrator SHALL 调用 Memory Manager 更新学习状态\n\n### Requirement 6: Quiz Skill（练习题生成技能）\n\n**User Story:** 作为学生，我希望通过说\"给我几道极限练习题\"来获得符合我当前掌握度的练习题，从而巩固知识点。\n\n#### Acceptance Criteria\n\n1. WHEN QuizSkill 被调用 THEN 它 SHALL 接收参数：topic, difficulty, num_questions\n2. WHEN difficulty 未指定 THEN 系统 SHALL 根据用户 mastery_map 推断难度（weak → easy, strong → hard）\n3. WHEN 调用 Gemini API THEN QuizSkill SHALL 使用 gemini-2.5-flash 模型\n4. WHEN LLM 返回结果 THEN QuizSkill SHALL 验证输出符合 output_schema（questions 数组结构）\n5. WHEN 输出验证通过 THEN QuizSkill SHALL 返回结构化题目列表（包含 stem, options, answer, explanation）\n\n### Requirement 7: Explain Skill（概念讲解技能）\n\n**User Story:** 作为学生，我希望通过说\"讲讲极限的定义\"来获得清晰的概念讲解，从而理解理论知识。\n\n#### Acceptance Criteria\n\n1. WHEN ExplainSkill 被调用 THEN 它 SHALL 接收参数：topic, depth（可选）\n2. WHEN depth 未指定 THEN 系统 SHALL 根据用户 mastery 推断讲解深度（weak → basic, strong → advanced）\n3. WHEN 调用 Gemini API THEN ExplainSkill SHALL 使用 gemini-2.5-flash 模型\n4. WHEN LLM 返回结果 THEN ExplainSkill SHALL 返回结构化讲解内容（包含 title, content, examples）\n\n### Requirement 8: 端到端集成流程\n\n**User Story:** 作为学生，我希望从输入问题到获得结果的整个流程无缝衔接，感受不到系统内部的复杂性。\n\n#### Acceptance Criteria\n\n1. WHEN 用户发送消息 THEN 前端 SHALL 调用统一的 `/agent/chat` API\n2. WHEN 后端收到请求 THEN 流程 SHALL 依次执行：Intent Router → Memory Manager → Skill Orchestrator → Skill Execute → Memory Update\n3. WHEN 任一步骤失败 THEN 系统 SHALL 返回友好的错误提示（如\"抱歉，我没太理解你的问题，能换个方式说吗？\"）\n4. WHEN 流程完成 THEN 前端 SHALL 根据 artifact 类型渲染对应的 UI 组件\n5. WHEN 响应时间超过 3 秒 THEN 前端 SHALL 显示加载状态\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n\n- **单一职责原则**：每个模块（Intent Router、Memory Manager、Skill Orchestrator、Skills）独立实现，职责明确\n- **模块化设计**：\n  - 后端：每个核心模块独立的 Python 文件/包\n  - 前端：UI 组件按功能拆分（ChatInterface、MessageRenderer、QuizCard、ExplainCard）\n- **依赖管理**：模块间通过明确的 API 接口通信，避免循环依赖\n- **清晰接口**：所有 Skill 实现统一的 `execute(params, context)` 签名\n\n### Performance\n\n- **Intent Router 响应时间**：≤ 500ms（使用轻量级 Gemini Flash 模型）\n- **Skill 执行时间**：QuizSkill ≤ 3s，ExplainSkill ≤ 2s\n- **端到端响应时间**：用户发送消息到前端渲染结果 ≤ 5s\n- **Token 优化**：Intent Router prompt ≤ 200 tokens，单个 Skill prompt ≤ 500 tokens\n\n### Security\n\n- **API Key 保护**：Gemini API Key 存储在后端环境变量中，不暴露给前端\n- **输入验证**：所有用户输入经过 Pydantic 模型验证，防止注入攻击\n- **错误处理**：敏感错误信息（如 API Key 错误）不直接返回前端\n\n### Reliability\n\n- **Fallback 机制**：\n  - Intent Router：置信度低时返回澄清问题\n  - Skill 执行：主模型失败时尝试 fallback 模型\n  - 网络错误：显示重试选项\n- **错误日志**：所有模块异常记录到日志文件，便于调试\n- **优雅降级**：当 Memory 服务不可用时，使用空上下文继续执行\n\n### Usability\n\n- **对话式交互**：用户只需自然语言输入，无需学习复杂操作\n- **即时反馈**：加载状态、进度提示清晰可见\n- **响应式设计**：界面适配桌面和移动端\n- **错误提示友好**：避免技术术语，用学生能理解的语言解释问题\n\n### Scalability & Extensibility\n\n- **技能可扩展**：添加新 Skill 只需：\n  1. 创建 `skills/{skill_id}/skill.json` 配置\n  2. 实现 `skills/{skill_id}/handler.py`\n  3. Registry 自动加载\n- **意图可扩展**：Intent Router 支持动态添加新 intent 标签\n- **存储可替换**：当前使用内存存储，接口设计支持无缝切换到 Redis/MongoDB\n\n## Out of Scope（MVP 不包含）\n\n以下功能在 demo 阶段不实现，但架构支持后续扩展：\n\n- ❌ 多技能 Pipeline（BundleSkill）\n- ❌ 用户认证系统\n- ❌ 持久化存储（Redis/MongoDB）\n- ❌ 实时 WebSocket 更新\n- ❌ 语音输入/输出\n- ❌ 多语言支持\n- ❌ Homework Skill、FlashcardSkill 等其他技能\n- ❌ 完整的用户画像分析（简化版 mastery_map）\n- ❌ 成本监控和预算控制\n\n## Success Metrics\n\nDemo 成功的标准：\n\n1. ✅ 用户能在一个界面完成\"练习题 → 讲解 → 再练习\"的完整学习流程\n2. ✅ Intent Router 对明确意图的识别准确率 > 85%\n3. ✅ 端到端响应时间 < 5 秒\n4. ✅ 系统能记住用户在会话中的主题切换\n5. ✅ 代码结构清晰，新增一个 Skill 只需 < 50 行代码\n6. ✅ 演示视频能展示核心价值：从工具箱到智能助手的体验提升\n\n",
  "fileStats": {
    "size": 10478,
    "lines": 195,
    "lastModified": "2025-11-13T07:59:04.071Z"
  },
  "comments": []
}